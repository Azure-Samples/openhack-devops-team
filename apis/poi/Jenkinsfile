pipeline {
  agent any

  stages {
    stage('build') {
      steps {
        script {
          ssh_docker = "ssh jenkins@jenkinsopenhackiva6.westeurope.cloudapp.azure.com"
          registry =  "openhackiva6acr.azurecr.io"
        }
        withCredentials([usernamePassword(credentialsId: '6f81a13c-2f1b-4547-b66b-5968150d8add', passwordVariable: 'PASSWORD_REGISTRY', usernameVariable: 'USERNAME_REGISTRY')]) {
          sh "${ssh_docker} docker login ${registry} --username ${USERNAME_REGISTRY} --pasword ${PASSWORD_REGISTRY}"
        }
        script { 
          image = "${registry}/poi:${env.BRANCH_NAME}-${BUILD_NUMBER}"
        }
        sh "${ssh_docker} docker build -t ${image} ."
        sh "${ssh_docker} docker push ${image}"
      }
    }
  }
}
